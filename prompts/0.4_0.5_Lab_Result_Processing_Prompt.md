# Vibe Engineering Prompt: Lab Result Processing (Supabase + Vision AI)

## Context
You are building the "Lab Result Processing Engine." This is a high-stakes feature that turns images/PDFs into structured medical data.

## Instructions
- Use Supabase Storage to create a bucket named `lab-results`.
- Create a `biomarkers` table:
    - `id` (UUID)
    - `user_id` (UUID)
    - `name` (Text - e.g., 'Vitamin D')
    - `value` (Numeric)
    - `unit` (Text - e.g., 'nmol/L')
    - `reference_range` (Text)
    - `test_date` (Date)
    - `source_file_url` (Text)
- Implement a Supabase Edge Function triggered by a file upload or a manual chat trigger.

## Backend Logic (Cursor Instructions)
1. **File Handling:** Logic to upload files to the `lab-results` bucket and generate a signed URL.
2. **AI Extraction:** Send the image/PDF content to an LLM with vision capabilities (GPT-4o). Use a strict system prompt to ensure the output is a JSON array of biomarkers.
3. **Prompt for AI:** "Extract all biomarkers from this lab report. Return a JSON list with: biomarker_name, value, unit, reference_min, reference_max. If the report is in a different language, translate the biomarker name to English."
4. **Data Insertion:** Parse the JSON response and insert multiple rows into the `biomarkers` table. Handle duplicates or multiple tests on the same date.

## Vibe Guidelines
- Accuracy is paramount. Implement a "confidence check" or allow the user to verify the extracted data in the UI before final saving.
- Secure the files with RLS; only the owner can view the uploaded report.
