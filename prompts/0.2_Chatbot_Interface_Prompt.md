# Vibe Engineering Prompt: Chatbot Interface (Supabase + AI Integration)

## Context
You are building the conversational core of "Food is My Medicine." This interface needs to handle text, images, and voice while maintaining a stateful conversation.

## Instructions
- Create a `messages` table in Supabase to store chat history.
    - `id` (UUID)
    - `user_id` (UUID)
    - `role` (Enum: 'user', 'assistant')
    - `content` (Text)
    - `metadata` (JSONB - to store card types like 'recipe', 'biomarker_summary')
    - `created_at` (Timestamp)
- Implement a backend Edge Function (Supabase Edge Functions) to handle the chat logic.
- The Edge Function should:
    1. Receive the user message.
    2. Retrieve relevant context (user profile, latest biomarkers).
    3. Call an LLM API (OpenAI/Anthropic).
    4. Format the response, including structured data for frontend "cards."

## Backend Logic (Cursor Instructions)
1. **Message Persistence:** Write the logic to save and fetch messages for a specific user, ordered by `created_at`.
2. **Context Injection:** Before sending the prompt to the LLM, fetch the user's `sex`, `age`, and most recent `biomarkers` from Supabase to provide personalized advice.
3. **Structured Responses:** The assistant should be prompted to return JSON fragments within its response when a "card" (like a recipe or lab summary) needs to be rendered.
4. **RLS:** Ensure users can only access their own message history.

## Vibe Guidelines
- The interface should feel snappy; use optimistic updates on the frontend for user messages.
- Ensure the Edge Function is optimized for low latency.
